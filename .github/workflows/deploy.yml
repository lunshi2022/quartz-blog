name: Deploy Quartz Site

on:
  push:
    branches: [ main ] # å½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘
    paths:
      - 'content/**'   # åªæœ‰ content ç›®å½•ä¸‹çš„ç¬”è®°å˜æ›´æ‰è§¦å‘ï¼Œæé«˜æ•ˆç‡

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest # ä½¿ç”¨ Linux ç¯å¢ƒæ„å»ºï¼Œèƒ½å®Œç¾è§„é¿ä½ ä¹‹å‰é‡åˆ°çš„ Windows åŸç”Ÿæ¨¡å—é—®é¢˜
    permissions:
      contents: write
    steps:
      # 1. æ‹‰å–ä½ çš„ Quartz æºç å’Œç¬”è®°
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # è·å–æ‰€æœ‰ Git å†å²ï¼Œè¿™å¯¹æŸäº›æ’ä»¶ï¼ˆå¦‚åŸºäºGitçš„é¡µé¢æ—¥æœŸï¼‰æ˜¯å¿…è¦çš„

      # 2. è®¾ç½® Node.js ç¯å¢ƒ
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # ä½¿ç”¨ç¨³å®šçš„ Node.js 20 LTS ç‰ˆæœ¬

      # 3. å®‰è£…ä¾èµ–å¹¶æ„å»º Quartz é™æ€ç½‘ç«™
      - name: Install and Build
        run: |
          npm ci          # ä½¿ç”¨ä¸ package-lock.json ä¸€è‡´çš„ä¾èµ–å®‰è£…ï¼Œæ›´ç¨³å®š
          npx quartz build # æ‰§è¡Œæ„å»ºï¼Œç”Ÿæˆ public æ–‡ä»¶å¤¹

      # 4. ä½¿ç”¨ SSH å¯†é’¥éƒ¨ç½²åˆ°ä½ çš„ä¸“å±åšå®¢ä»“åº“
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          # ä½¿ç”¨ä½ åœ¨ä»“åº“ Secrets ä¸­é…ç½®çš„ SSH ç§é’¥
          deploy_key: ${{ secrets.QUARTZ_DEPLOY_KEY }}
          # ğŸ”´ è¿™æ˜¯å”¯ä¸€éœ€è¦ä½ ä¿®æ”¹çš„åœ°æ–¹ï¼šæ”¹æˆä½ çš„åšå®¢ä»“åº“ï¼Œä¾‹å¦‚ `ä½ çš„ç”¨æˆ·å/ä½ çš„ç”¨æˆ·å.github.io`
          external_repository: lunshi2022/lunshi2022.github.io
          # å¯¹äº <ç”¨æˆ·å>.github.io è¿™ç±»ä»“åº“ï¼Œé€šå¸¸å‘å¸ƒåˆ° main åˆ†æ”¯
          publish_branch: main
          # å‘å¸ƒ Quartz ç”Ÿæˆçš„é™æ€æ–‡ä»¶ç›®å½•
          publish_dir: ./public
          # ä¿ç•™ç›®æ ‡ä»“åº“çš„æäº¤å†å²
          force_orphan: false